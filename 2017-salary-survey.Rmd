---
title: "2017 Land Trust Salaries and Benefits Survey"
author: "Katie Chang"
date: "November 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries, include=FALSE}
library(readr)
library(tidyr)
library(dplyr)
library(ggplot2)
library(scales)
library(maps)
library(RColorBrewer)
library(ggthemes)

```

First conducted in 2000, the Land Trust Salaries and Benefits Survey is the only comprehensive source of staff compensation data exclusively for the land trust community. Many land trusts have told us that this survey is one of the most useful resources the Land Trust Alliance provides. For more information, please see <http://www.lta.org/salarysurvey>.

## Questions to Consider

* What is the pay gap between male and female executive directors? 

* Does it change with years of experience, operating budget, geographic region, number of FT staff?

* Do organizations that pay female executice directors less than average also pay lower salaries for other positions?

* Do organizations that pay less compensate by offering more generous benefits? Or do larger organizations tend to offer better benefits?

* Can we assign an index or "score" to each organization that rates its total salary and benefits package compared to its peers?

* If we cluster organizations by number of staff or operating budget

Let's start by reading the raw data CSV file to see what we've got and start some clean-up.

```{r include=FALSE}
surveydata <- read_csv("C:/Users/KChang.000/Desktop/Data Science/capstone-project/sm-survey-data.csv")
```

## Data Clean-up

The online survey did not enforce input validation so we'll need to remove extraneous dollar signs and commas from numeric fields such as Budget, EDsalary, YearsExp, and YearsExpOtherOrgs.

```{r}
# remove dollar signs and commas
x <- gsub("\\$", "", surveydata$Budget)
surveydata$Budget <- as.numeric(gsub(",","", x))

x <- gsub("\\$", "", surveydata$EDsalary)
surveydata$EDsalary <- as.numeric(gsub(",","", x))

# convert years to numeric
surveydata$YearsExp <- as.numeric(gsub(",","", surveydata$YearsExp))

surveydata$YearsExpOtherOrgs <- as.numeric(gsub(",","", surveydata$YearsExpOtherOrgs))

```

Because this was a fairly long survey, it was not uncommon for respondents to leave some questions blank. To avoid  dropping entire responses due to a few NA values, I'll Wait until after we start pulling out subsets of columns to drop NA rows.

Since we'll be using the budget and ED salary columns frequently, I'll remove a few obvious outliers, such as respondents that entered the budget year or any budget less than 1000. It's not feasible for an organization that has at least one full-time paid staff to have a budget that low. Similarly, any ED salary should be greater than 0.

```{r}
# remove budget values of "2016" and "2017" and any values less than 1000
surveydata <- surveydata[surveydata$Budget > 1000, ]
surveydata <- surveydata[surveydata$Budget != 2016, ]
surveydata <- surveydata[surveydata$Budget != 2017, ]

# remove ED salaries < zero
surveydata <- surveydata[surveydata$EDsalary > 0, ]
```

## Salaries

### Executive Director

```{r include=FALSE}
edsalaries <- select(surveydata, 'Budget', 'YearsExp', 'YearsExpOtherOrgs', 'EDgender', 'EDsalary')

edsalaries <- drop_na(edsalaries)
names(edsalaries) <- c("budget", "years_exp", "years_other", "gender", "salary")

## add new column for total years of experience
edsalaries$totalexp <- edsalaries$years_exp + edsalaries$years_other
edsalaries <- edsalaries[edsalaries$totalexp <= 50, ]

## remove unknown gender to simplify trendlines
edsalaries_mf <- subset(edsalaries, gender != "Prefer not to answer")

myColors <- c("#CBDB2B", "#006893")
myLabels <- c("Female", "Male")

```

Do organizations with larger budgets pay their executive directors higher salaries? The answer appears to be yes.

```{r echo=FALSE}
## scatter plot of x = operating budget, y = salary for organizations with budgets up to $3 million
ggplot(edsalaries_mf, aes(x = budget, y = salary)) +
  geom_point(alpha = 0.4) +
  geom_smooth(se = FALSE, method = "lm", formula = y ~ poly(x, 2), size = 1) +
  coord_cartesian(xlim = c(min(edsalaries_mf$budget), 3000000), ylim = c(20000, 250000)) +
  labs(x = "Operating Budget", y = "Annual Salary") +
  theme_light() +
  scale_x_continuous(labels = comma) +
  scale_y_continuous(labels = comma) +
  theme(legend.title = element_blank())
```

But notice how the graph changes when you take the executive director's gender into consideration.

```{r echo=FALSE}
## scatter plot of x = operating budget, y = salary for organizations with budgets up to $3 million
ggplot(edsalaries_mf, aes(x = budget, y = salary, col = gender)) +
  geom_point(alpha = 0.5) +
  geom_smooth(se = FALSE, method = "lm", formula = y ~ poly(x, 2), size = 1) +
  coord_cartesian(xlim = c(min(edsalaries_mf$budget), 3000000), ylim = c(20000, 250000)) +
  labs(x = "Operating Budget", y = "Annual Salary") +
  theme_light() +
  scale_x_continuous(labels = comma) +
  scale_y_continuous(labels = comma) +
  theme(legend.title = element_blank()) +
  scale_color_manual("Gender", 
                     values = myColors,
                     labels = myLabels)
```

This doesn't look good. Before we automatically assume unconscious bias or institutional sexism, could there be some other factor why men are paid more? Maybe they have longer tenures. Let's compare years at the current organization to salary.

```{r EDsalarychart3, echo=FALSE}

## scatterplot with no title, linear trendline with polynomial curvature
ggplot(edsalaries_mf, aes(x = years_exp, y = salary, col = gender)) +
  geom_point(alpha = 0.5, position = "jitter") +
  geom_smooth(se = FALSE, method = "lm", formula = y ~ poly(x, 2), size = 1) +
  labs(x = "Years at Current Organization", y = "Annual Salary") +
  theme_light() +
  scale_y_continuous(labels = comma) +
  theme(legend.title = element_blank()) +
  scale_color_manual("Gender", 
                     values = myColors,
                     labels = myLabels)

```

Maybe men have more total years of experience, when you add up both years at the current organization and years at other conservation organizations.

```{r echo=FALSE}
## scatterplot with no title, linear trendline with polynomial curvature
ggplot(edsalaries_mf, aes(x = totalexp, y = salary, col = gender)) +
  geom_point(alpha = 0.5, position = "jitter") +
  geom_smooth(se = FALSE, method = "lm", formula = y ~ poly(x, 2), size = 1) +
  labs(x = "Total Years of Experience", y = "Annual Salary") +
  theme_light() +
  scale_y_continuous(labels = comma) +
  theme(legend.title = element_blank()) +
  scale_color_manual("Gender", 
                     values = myColors,
                     labels = myLabels)
```

Can we build a model to predict an executive director's salary? Let's try these as our initial independent variables:
* Operating budget
* ED gender
* Years of experience

Should we add these to the dataset?
* Total number of full-time staff
* State or region

```{r}
# convert gender to 0 and 1 values: 0 is female and 1 is male
edsalaries_mf$gend <- 0
edsalaries_mf$gend <- replace(edsalaries_mf$gend, edsalaries_mf$gender == "Male", 1)

```


```{r}
EDsalaryReg <- lm(salary ~ budget + gender + years_exp + years_other + totalexp, data = edsalaries_mf)
summary(EDsalaryReg)
```

```{r}

# remove totalexp variable from model
EDsalaryReg2 <- lm(salary ~ budget + gender + years_exp + years_other, data = edsalaries_mf)
summary(EDsalaryReg2)

```

```{r}
# remove years_other variable from model
EDsalaryReg3 <- lm(salary ~ budget + gender + years_exp, data = edsalaries_mf)
summary(EDsalaryReg3)
```

```{r}
# use numeric gender variable
EDsalaryReg4 <- lm(salary ~ budget + gend + years_exp, data = edsalaries_mf)
summary(EDsalaryReg4)
```

### Other Staff

## Benefits

### Paid Leave for Vacation, Sick, Holidays, Personal and PTO

Next we'll look at how much paid leave land trust staff get for vacation, holidays, sick days, personal days and PTO. 

> Paid Time Off (PTO) is a program in which employees are given a set number of days off each year to be taken at their > discretion, as opposed to separate time off for vacation days, sick days and holidays.

```{r include=FALSE}

# pull paid leave columns from main data set
paidleave <- select(surveydata, 'Budget', 'VacationFirstYr', 'VacationFifthYr', 'SickFirstYr', 'SickFifthYr', 'HolidayFirstYr', 'HolidayFifthYr', 'PersonalFirstYr', 'PersonalFifthYr', 'PTOFirstYr', 'PTOFifthYr')
  
## consolidate types of leave into one column with key = leavetype and value = days
tidyleave <- gather(paidleave, 'VacationFirstYr', 'VacationFifthYr', 'SickFirstYr', 'SickFifthYr', 'HolidayFirstYr', 'HolidayFifthYr', 'PersonalFirstYr', 'PersonalFifthYr', 'PTOFirstYr', 'PTOFifthYr', key = "leavetype", value = "days")

## make sure days is in integers
tidyleave$days <- as.integer(tidyleave$days)

## remove rows where days is NA
tidyleave <- drop_na(tidyleave)

## add new column for tenure, which is either 1 for first year of employment or 5 for five years
tidyleave$tenure <- as.integer(5)

for (x in 1:nrow(tidyleave)) {
  if (grepl("First", tidyleave$leavetype[[x]])) {
    tidyleave$tenure[[x]] = 1
  }
}

## remove "FirstYr" and "FifthYr" from values in leavetype column
for (x in 1:nrow(tidyleave)) {
  value = tidyleave$leavetype[[x]]
  tidyleave$leavetype[[x]] <- substr(value, 1, nchar(value)-7) 
}

```

We asked about each of these types of leave for first-year and fifth-year staff.

```{r echo=FALSE}
## scatterplot of days of each type of leave, color coded by tenure
ggplot(tidyleave, aes(x = leavetype, y = days, col = as.factor(tenure))) +
  geom_jitter(alpha = 0.5) +
  labs(x = "Leave Type", y = "Number of Days") +
  theme_light() +
  theme(legend.title = element_blank()) +
  scale_color_manual("Tenure", 
                     values = myColors,
                     labels = c("First year", "Fifth year"))
```

### Health Insurance

# Respondents

## By state

## By number of full-time staff
